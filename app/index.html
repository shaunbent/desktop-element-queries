<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spotify Desktop</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<div class="c-app">
  <div class="c-app__panel-container">
    <div class="c-app__panel">
      <div class="c-panel c-panel--secondary navbar" data-panel-name="navbar">
        <div class="c-panel__content">
          <p>Navbar</p>
        </div>
        <div class="c-panel__resizer c-panel__resizer--right"></div>
      </div>
    </div>
    <div class="c-app__panel c-app__panel--primary" id="app-panel">
      <div class="c-panel c-panel--primary c-demo-panel">
        <div class="o-wrap">
          <div class="resize-info"></div>
          <div class="breakpoint-info"></div>
        </div>
      </div>
    </div>
    <div class="c-app__panel">
      <div class="c-panel c-panel--secondary friend-feed" data-panel-name="friend-feed">
        <div class="c-panel__content">
          <p>Friend Feed</p>
        </div>
        <div class="c-panel__resizer c-panel__resizer--left"></div>
      </div>
    </div>
  </div>
  <div class="c-app__player">
    <p>Player</p>
  </div>
</div>

<script>
const resizeInfoElement = document.querySelector('.resize-info');

if (typeof ResizeObserver === 'function') {
  document.querySelector('.breakpoint-info').style.setProperty('display', 'block');
  const ro = new ResizeObserver(entries => {
    for (let entry of entries) {
      const width = entry.contentRect.width;
      const height = entry.contentRect.height;
      const resizeInfo = `
        <p>
          <b>Width:</b> ${width}px,
          <b>Height:</b> ${height}px
        </p>
      `;
      resizeInfoElement.innerHTML = resizeInfo;

      // Data Attributes
      entry.target.dataset.panelWidth = width;
      entry.target.dataset.panelHeight = height;

      // Breakpoints
      let activeBreakpoints = {
        minWidth: [],
        maxWidth: []
      };

      const breakpoints = {
        'glue-min': 376,
        'glue-s': 592,
        'glue-m': 860,
        'glue-l': 1280,
        'glue-max': 1496
      };

      for(breakpoint in breakpoints) {
        if (width >= breakpoints[breakpoint]) {
          activeBreakpoints.minWidth.push(breakpoint);
        } else {
          activeBreakpoints.maxWidth.push(breakpoint);
        }
      }

      entry.target.dataset.minWidth = activeBreakpoints.minWidth.join(',');
      entry.target.dataset.maxWidth = activeBreakpoints.maxWidth.join(',');
    }
  });

  ro.observe(document.querySelector('#app-panel'));
} else {
  resizeInfoElement.innerHTML = `
    <div class="warning">
      <p><b>Important:</b> Requires \`ResizeObserver\`s to be enabled.</p>
      <p>To enable in Chrome, go to \`chrome://flags\` and enable the "Experimental Web Platform flag"</p>
    </div>
  `;
}

let currentPanel = null;
function resizeStarted(e) {
  currentPanel = e.target.parentNode;
  window.addEventListener('mousemove', resizePanel, false);
  window.addEventListener('mouseup', resizeStopped, false);
}

function resizeStopped() {
  currentPanel = null;
  window.removeEventListener('mousemove', resizePanel, false);
  window.removeEventListener('mouseup', resizeStopped, false);
}

function resizePanel(e) {
  const panelName = currentPanel.dataset.panelName;
  let width = e.clientX;

  if (panelName === 'friend-feed') {
    width = e.clientX - window.innerWidth;
  }

  currentPanel.style.setProperty(`--${panelName}-width`, `${width}px`);
}

const resizeHandles = document.querySelectorAll('.c-panel__resizer');

resizeHandles.forEach(handle => {
  handle.addEventListener('mousedown', resizeStarted, false);
});
</script>
</body>
</html>
